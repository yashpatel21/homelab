---
# =============================================================================
# IT Tools Docker Compose Configuration
# =============================================================================
# 
# This Docker Compose file deploys IT Tools with:
# - Collection of handy online developer tools
# - Traefik integration via labels
# - WUD labels for update notifications
# - Homelab network integration
# - SSL termination via Traefik
#
# Generated from Ansible template: it-tools-compose.yml.j2
# =============================================================================

networks:
  {{ homelab_network_name }}:
    external: true

services:
  it-tools:
    image: corentinth/it-tools:2024.10.22-7ca5933
    container_name: it-tools
    restart: always
    networks:
      - {{ homelab_network_name }}
    labels:
      # Traefik configuration
      - "traefik.enable=true"
      - "traefik.http.routers.it-tools.rule=Host(`ittools.{{ base_domain }}`)"
      - "traefik.http.routers.it-tools.entrypoints=websecure"
      - "traefik.http.routers.it-tools.tls.certresolver={{ ssl_cert_resolver }}"
{% if auth_enabled | default(false) %}
      # Forward authentication to Authentik for developer tools access
      - "traefik.http.routers.it-tools.middlewares=authentik@file"
{% endif %}
      - "traefik.http.services.it-tools.loadbalancer.server.port=80"
      
      # WUD update notifications - Date-based versioning (YYYY.MM.DD-hash format)
      - "wud.watch=true"
      - "wud.tag.include=^20[0-9]{2}\\.[0-9]{1,2}\\.[0-9]{2}(-[a-f0-9]+)?$"
      - "wud.tag.exclude=alpha|beta|rc|dev"
      - "wud.tag.transform=^(20[0-9]{2}\\.[0-9]{1,2}\\.[0-9]{2})(-[a-f0-9]+)?$ => $1"
      - "wud.trigger.include=command.ntfy"
      - "wud.display.name=IT Tools"
      - "wud.link.template=https://github.com/CorentinTh/it-tools/releases/tag/v$${raw}"