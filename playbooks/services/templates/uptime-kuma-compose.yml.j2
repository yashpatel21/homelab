services:
  uptime-kuma:
    image: louislam/uptime-kuma:1.23.16
    container_name: uptime-kuma
    restart: unless-stopped
    volumes:
      - {{ data_directory }}/uptime-kuma/data:/app/data
      - /var/run/docker.sock:/var/run/docker.sock:ro
    networks:
      - {{ homelab_network_name }}
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.uptime-kuma.rule=Host(`uptime.{{ base_domain }}`)"
      - "traefik.http.routers.uptime-kuma.entrypoints=websecure"
      - "traefik.http.routers.uptime-kuma.tls.certresolver={{ ssl_cert_resolver }}"
{% if auth_enabled | default(false) %}
      # Single router with main authentik middleware
      - "traefik.http.routers.uptime-kuma.middlewares=authentik@file"
{% endif %}
      - "traefik.http.services.uptime-kuma.loadbalancer.server.port=3001"
      # WUD update notifications - Major/Minor only with semantic versioning
      - "wud.watch=true"
      - "wud.tag.include=^\\d+\\.\\d+\\.\\d+$"
      - "wud.tag.exclude=alpha|beta|rc|dev"
      - "wud.trigger.include=command.ntfy"
      - "wud.display.name=Uptime Kuma"
      - "wud.link.template=https://github.com/louislam/uptime-kuma/releases/tag/$${raw}"

networks:
  {{ homelab_network_name }}:
    external: true